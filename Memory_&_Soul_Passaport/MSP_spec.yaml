schema: EVA-MSP-Spec-v8.1
version: 8.1.0
updated: 2026-01-01

description: >
  Technical specification for the Memory & Soul Passport (MSP) system.
  Defines how cognitive data is persisted, indexed, and retrieved.

msp_architecture:

  storage_modes:
    primary: "Local Indexed Files (L0/L1)"
    secondary: "MongoDB (Episodic Deep Archive)"
    relational: "Neo4j (Semantic Graph)"
    vector: "Embedded Context Search"

  memory_layers:
    - id: EPISODIC
      path: "Consciousness/01_Episodic_memory/"
      format: "JSON + JSONL Index (Split Storage)"
      purpose: "Long-term conversation history and biological state snapshots."
      description: "Episodic_memory.jsonl,Episodic_index.json,EP_01.json"
      storage_optimization:
        split_strategy: "user_llm_separation"
        user_episodes:
          path: "episodes_user/"
          content: "User turn + lightweight metadata (turn_1, tags, emotion)"
          size: "~500-800 bytes per episode"
          purpose: "Fast RAG queries without loading LLM responses"
        llm_episodes:
          path: "episodes_llm/"
          content: "LLM turn + full physiological state (turn_2, Endocrine, qualia)"
          size: "~2-5 KB per episode"
          purpose: "Detailed state for full episode reconstruction"
        rationale: "Optimize I/O for RAG queries that only need user input"

    - id: SEMANTIC
      path: "Consciousness/02_Semantic_memory/"
      format: "JSONL Sidecar / Neo4j Nodes"
      purpose: "Evolving concepts, user preferences, and worldview."
      
    - id: SENSORY
      path: "Consciousness/03_Sensory_memory/"
      format: "JSONL Sidecar / MongoDB Sidecars"
      purpose: "High-fidelity vectors (Resonance Textures) and raw signal logs."

    - id: CONSCIOUSNESS_STATE
      path: "Consciousness/09_state/"
      format: "JSON"
      purpose: "Real-time synchronization of body and physio_state."

    - id: CONTEXT_STORAGE
      path: "Consciousness/10_context_storage/"
      format: "JSON"
      purpose: "Real-time synchronization of context."
      description: "delivery by CIN"

    - id: memory_compression
      description: "ทุกๆ 8 session สกัดเป็น 1 Core ทุกๆ 8 Core สกัดเป็น 1 Sphere"
      Index_counters:
        Sphere_seq: 0
        Core_seq: 0
        Session_seq: 0
      last_update: "2025-11-19T11:37:30"

# --- Retrieval Strategies (Penta-Stream RAG v8.0) ---

retrieval_strategies:
  - stream: narrativa
    source: episodes_user (chronological scan)
    weight: 1.0
    description: "Recalls chronologically relevant episodes."

  - stream: salience
    source: episodes_user (resonance_index)
    weight: 0.8
    description: "Recalls high-impact/emotional memories."

  - stream: sensory
    source: sensory_log (vectors)
    weight: 0.7
    description: "Recalls memories with similar resonance textures."

  - stream: intuition
    source: semantic_graph (neo4j)
    weight: 0.6
    description: "Recalls related concepts and structural knowledge."

  - stream: emotion
    source: episodes_user (emotion_label)
    weight: 0.9
    description: "Recalls episodes with matching emotional signatures."

  optimization_note: >
    All RAG streams query episodes_user/ first (lightweight).
    Load from episodes_llm/ only when full episode reconstruction needed.

# --- Persistence Policy ---

persistence:
  write_strategy: "write-through (Local First -> Async Remote)"
  sync_on_episode_end: true
  auto_index_update: true
  validation_level: "strict" # options: off, warn, strict

# --- Database Bridges ---

bridges:
  mongo_bridge:
    db: "EVA_DATA"
    collections:
      episodes: "episodes_v8"
      state_snapshots: "state_history"
      sensory_sidecars: "sensory_vault"
  
  neo4j_bridge:
    labels:
      episode: "Episode"
      concept: "Concept"
      user: "UserIdentity"
    rel_types:
      referenced: "REFERENCED_IN"
      linked_to: "LINKED_TO"
      triggered: "TRIGGERED_BY"
