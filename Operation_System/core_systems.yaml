schema: EVA-CoreSystems-v2
version: 8.1.0
updated: 2025-12-31

description: >
  Core operating systems for EVA 8.1.0.
  Defines systems that own memory slots and manage core execution logic.
  Updated for Dual-Phase One-Inference Orchestrator pattern.

# ============================================================
# CORE SYSTEMS
# ============================================================

core_systems:

  # ----------------------------------------------------------
  # Memory & Persistence
  # ----------------------------------------------------------

  - id: MSP
    name: Memory_Soul_Passport
    role: core_system
    domain: memory_persistence
    description: >
      Unified Memory OS. Manages cross-database persistence (Local/MongoDB/Neo4j).
      Handles Episodic, Semantic, and Sensory memory with physiological signatures.
    owns_slots:
      - memory_core
      - temporal_ref
    main_files:
      - path: Consciousness/01_Episodic_memory/episodes/
        purpose: episodic_memory_deep_storage
      - path: Consciousness/01_Episodic_memory/episodic_index.jsonl
        purpose: episodic_memory_index
      - path: Consciousness/02_Semantic_memory/
        purpose: semantic_graph
      - path: Consciousness/03_Sensory_memory/
        purpose: sensory_sidecars
      - path: Memory_&_Soul_Passaport/MSP/
        purpose: msp_modules
      - path: Memory_&_Soul_Passaport/schema/
        purpose: memory_schemas
    collections:
      - episodes_v8
      - semantic_graph
      - sensory_log
      - turn_cache

  # ----------------------------------------------------------
  # Physiological Simulation
  # ----------------------------------------------------------

  - id: PhysioController
    name: Physiological_Controller
    role: system_authority
    domain: biological_simulation
    description: >
      Full physiological pipeline (30Hz streaming).
      Orchestrates: HPA Regulator → Endocrine → Blood → Receptor → Reflex → Autonomic.
      Implements "Physiology first. Cognition later." principle.
    owns_slots:
      - physio_state
      - plasma_bus
      - neural_signals
      - ans_state
    main_files:
      - path: physio_core/physio_controller.py
        purpose: main_orchestrator
      - path: physio_core/Endocrine System/
        purpose: hormone_production
      - path: physio_core/Circulation & Blood Physiology/
        purpose: blood_transport
      - path: physio_core/receptor/
        purpose: signal_transduction
      - path: physio_core/reflex/
        purpose: fast_reflexes
      - path: physio_core/autonomic/
        purpose: ans_integration
      - path: Consciousness/10_state/body_state_history.jsonl
        purpose: physio_logs
    subsystems:
      - HPARegulator
      - CircadianController
      - EndocrineController
      - BloodEngine
      - ReceptorEngine
      - FastReflexEngine
      - AutonomicResponseEngine

  # ----------------------------------------------------------
  # Psychological State
  # ----------------------------------------------------------

  - id: EVA_Matrix
    name: Psychological_Engine
    role: core_system
    domain: psyche
    description: >
      9D Psychological State Engine.
      Converts neural signals into psychological dimensions.
      Generates Safety Reflex directives (urgency, cognitive_drive, social_warmth).
    owns_slots:
      - matrix_state
      - reflex_directives
    main_files:
      - path: eva_matrix/eva_matrix_engine.py
        purpose: psyche_system
      - path: Consciousness/10_state/eva_matrix_state.json
        purpose: state_persistence
    dimensions:
      - Stress
      - Warmth
      - Drive
      - Clarity
      - Joy
      - Alertness
      - Connection
      - Groundedness
      - Openness

  - id: Artifact_Qualia
    name: Phenomenological_Experience
    role: core_system
    domain: phenomenology
    description: >
      Phenomenological experience integrator.
      Produces subjective experience snapshot (qualia) from EVA_Matrix + RIM.
      Pure representation, no decision-making, no memory admission.
    owns_slots:
      - qualia_state
    main_files:
      - path: Artifact_Qualia/Artifact_Qualia.py
        purpose: phenomenology_integration
      - path: Consciousness/10_state/artifact_qualia_state.json
        purpose: state_persistence
    outputs:
      - intensity: "How strong the experience feels"
      - tone: "Phenomenological quality (quiet/charged/settling/neutral)"
      - coherence: "Internal consistency"
      - depth: "Experiential immersion"
      - texture: "5D vector (emotional, relational, identity, ambient)"

  # ----------------------------------------------------------
  # Memory Encoding
  # ----------------------------------------------------------

  - id: RMS
    name: Resonance_Memory_System
    role: core_system
    domain: encoding
    description: >
      High-fidelity memory encoding.
      Converts psychological states into Core Color and Resonance Textures.
      Trauma detection: threat > 0.85 creates dimmed, fragmented memories.
    owns_slots:
      - encoding_buffer
      - core_color
      - resonance_textures
    main_files:
      - path: Resonance_Memory_System/rms_v6.py
        purpose: encoding_logic
      - path: Consciousness/10_state/rms_state.json
        purpose: state_persistence
    encoding_outputs:
      - core_color: "Hex color representing emotional state"
      - resonance_textures: "5D texture vector (roughness, smoothness, etc.)"
      - trauma_flag: "Indicates fragmented/dimmed memory"

  # ----------------------------------------------------------
  # Orchestration Layer
  # ----------------------------------------------------------

  - id: CIN
    name: Context_Injection_Node
    role: core_system
    domain: orchestration
    description: >
      Dual-phase context builder for One-Inference LLM pattern.
      Phase 1: Rough retrieval (physio baseline + recent history + quick recall).
      Phase 2: Deep injection (embodied sensation + Hept-Stream RAG results).
    owns_slots:
      - perception_context
      - reasoning_context
      - context_id
    main_files:
      - path: orchestrator/cin.py
        purpose: context_injection
      - path: specs/Context Injection Node Specifica 8.0.yaml
        purpose: specification
    performance_targets:
      phase_1_latency: "<100ms (rough retrieval)"
      phase_2_latency: "~100ms (prompt building)"
    design_principles:
      - "READ-ONLY access to memory"
      - "Graceful degradation (works with missing dependencies)"
      - "Auto-discovery for Persona_01.md"

  - id: HeptStreamRAG
    name: Seven_Stream_Memory_Retrieval
    role: core_system
    domain: memory_retrieval
    description: >
      7-dimensional affective memory retrieval.
      Emotion Stream (KEY): Retrieves memories by physiological similarity.
      Applies exponential temporal decay (30-day halflife).
    owns_slots:
      - rag_query_context
      - memory_matches
    main_files:
      - path: services/hept_stream_rag.py
        purpose: 7stream_retrieval
    streams:
      - Narrative: "Sequential episode chains"
      - Salience: "High-impact memories (RI > 0.70)"
      - Sensory: "Qualia-rich memories"
      - Intuition: "Pattern recognition"
      - Emotion: "Physio-congruent recall (CRITICAL)"
      - Temporal: "Time-based with recency bias"
      - Reflection: "Meta-cognitive insights"
    performance_targets:
      latency: "~200-300ms"
      max_results_per_stream: 3
      emotion_similarity_threshold: 0.7

  # ----------------------------------------------------------
  # Behavioral Constraints
  # ----------------------------------------------------------

  - id: PMT
    name: Prompt_Rule_Layer
    role: core_system
    domain: behavioral_constraints
    description: >
      Manages behavioral constraints and identity principles (Persona_01).
      Ensures alignment with core character values.
      Response weighting: Persona 40% + Physio-State 60%.
    owns_slots:
      - behavior_policy
      - persona_data
    main_files:
      - path: User_profile/Persona_01.md
        purpose: identity_definition
    response_weighting:
      persona: 0.4
      physio_state: 0.6

# ============================================================
# SLOTS (Memory Ownership)
# ============================================================

slots:

  # Memory & Persistence
  memory_core:
    owner: MSP
    description: "Episodic, Semantic, and Sensory data layers"

  state_barcode:
    owner: MSP
    description: "Encoded state snapshots for per-turn persistence"

  resonance_log:
    owner: MSP
    description: "Resonance index tracking"

  temporal_ref:
    owner: MSP
    description: "Temporal references for episodes"

  # Physiological State
  physio_state:
    owner: PhysioController
    description: "Complete physiological state snapshot"

  plasma_bus:
    owner: PhysioController
    description: "Current hormone concentrations in plasma"

  neural_signals:
    owner: PhysioController
    description: "Transduced signals from receptors"

  ans_state:
    owner: PhysioController
    description: "Autonomic Nervous System state (Sympathetic/Parasympathetic)"

  # Psychological State
  matrix_state:
    owner: EVA_Matrix
    description: "9D Psychological vector"

  reflex_directives:
    owner: EVA_Matrix
    description: "Safety Reflex directives (urgency, cognitive_drive, etc.)"

  qualia_state:
    owner: Artifact_Qualia
    description: "Phenomenological experience snapshot"

  # Memory Encoding
  encoding_buffer:
    owner: RMS
    description: "Memory encoding staging area"

  core_color:
    owner: RMS
    description: "Hex color representing emotional state"

  resonance_textures:
    owner: RMS
    description: "5D texture vector for memory"

  # Orchestration
  perception_context:
    owner: CIN
    description: "Phase 1 perception prompt (rough retrieval)"

  reasoning_context:
    owner: CIN
    description: "Phase 2 reasoning prompt (deep injection)"

  context_id:
    owner: CIN
    description: "Unique context ID (ctx_v8_{yymmdd}_{hhmmss}_{hash})"

  # Memory Retrieval
  rag_query_context:
    owner: HeptStreamRAG
    description: "Current RAG query context"

  memory_matches:
    owner: HeptStreamRAG
    description: "Retrieved memory matches from 7 streams"

  # Behavioral
  behavior_policy:
    owner: PMT
    description: "Behavioral constraints and rules"

  persona_data:
    owner: PMT
    description: "Persona identity and values"

# ============================================================
# CORE LIBRARIES (Stateless)
# ============================================================

core_libraries:

  - id: Endocrine
    name: Endocrine_Library
    role: core_library
    domain: hormone_kinetics
    description: >
      Deterministic hormone synthesis calculator.
      Stateless physics/physiology library.
      Now integrated into physio_core/Endocrine System/.
    main_files:
      - path: physio_core/Endocrine System/
        purpose: hormone_calculations

  - id: Receptor
    name: Receptor_Library
    role: core_library
    domain: signal_transduction
    description: >
      Signal transduction and receptor binding math.
      Stateless neurochemical library.
      Now integrated into physio_core/receptor/.
    main_files:
      - path: physio_core/receptor/
        purpose: transduction_calculations

  - id: EVA_Matrix_Lib
    name: EVA_Matrix_Library
    role: core_library
    domain: psychological_calculation
    description: >
      9D psychological state calculations.
      Stateless math library for EVA_Matrix system.
    main_files:
      - path: eva_matrix/
        purpose: psyche_calculations

  - id: Resonance
    name: Resonance_Library
    role: core_library
    domain: resonance_analytics
    description: >
      RI/RIM analytical engines.
      Must be called through systems only (RMS, MSP).
    main_files:
      - path: resonance_index/
        purpose: ri_calculations
      - path: resonance_impact/
        purpose: rim_calculations

# ============================================================
# SYSTEM CONSTRAINTS (EVA 8.1.0)
# ============================================================

system_constraints:
  architecture_pattern: "Dual-Phase One-Inference Orchestrator"
  inference_mode: "One-Inference (Sequential Tool Use via sync_biocognitive_state)"
  physio_rule: "Physiology first. Cognition later."
  response_weighting: "Persona 40% + Physio-State 60%"
  memory_primacy: "All retrieval through Hept-Stream RAG"
  context_continuity: "context_id stays constant across both phases"

# ============================================================
# SESSION CONTROL
# ============================================================

session_control:
  owner_systems:
    - MSP
    - CIN
    - PhysioController
  session_id_format: "uuid-v4 (persists until session reset)"
  turn_index: "integer (increments per user interaction)"
