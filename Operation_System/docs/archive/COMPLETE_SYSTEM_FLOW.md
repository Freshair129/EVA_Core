# EVA 8.1.0 - Complete System Flow

**Date:** 2025-12-31
**Purpose:** à¹„à¸¥à¹ˆ flow à¸—à¸±à¹‰à¸‡à¸£à¸°à¸šà¸šà¹à¸šà¸šà¸¥à¸°à¹€à¸­à¸µà¸¢à¸” - à¹ƒà¸„à¸£à¸—à¸³à¸­à¸°à¹„à¸£ à¹ƒà¸„à¸£à¸ªà¹ˆà¸‡à¸­à¸°à¹„à¸£à¹ƒà¸«à¹‰à¹ƒà¸„à¸£ à¹ƒà¸„à¸£à¸”à¸¶à¸‡ stream à¸ˆà¸²à¸à¹ƒà¸„à¸£

---

## Table of Contents

1. [System Components Overview](#system-components-overview)
2. [Complete Flow Diagram](#complete-flow-diagram)
3. [Phase-by-Phase Breakdown](#phase-by-phase-breakdown)
4. [Data Contracts](#data-contracts)
5. [Component Interactions](#component-interactions)
6. [CIN Injection Details](#cin-injection-details)

---

## System Components Overview

### Core Systems (Owners & Responsibilities)

| Component | Role | Owns Slots | Owns Files | Direction |
|:---|:---|:---|:---|:---|
| **MSP** | Memory Persistence | memory_core, state_barcode, temporal_ref | Episodic/Semantic/Sensory files | **WRITE** |
| **PhysioController** | Body Simulation | physio_state, plasma_bus, neural_signals, ans_state | body_state_history.jsonl | **WRITE** |
| **EVA_Matrix** | 9D Psychology | matrix_state, reflex_directives | eva_matrix_state.json | **WRITE** |
| **Artifact_Qualia** | Phenomenology | qualia_state | artifact_qualia_state.json | **WRITE** |
| **RMS** | Memory Encoding | encoding_buffer, core_color, resonance_textures | rms_state.json | **WRITE** |
| **CIN** | Context Builder | perception_context, reasoning_context, context_id | None (READ-ONLY) | **READ** |
| **HeptStreamRAG** | Memory Retrieval | rag_query_context, memory_matches | None (READ-ONLY) | **READ** |
| **PMT** | Behavioral Rules | behavior_policy, persona_data | pmt_violations.log | **READ/WRITE** |

### Subsystems (Under PhysioController)

| Subsystem | Purpose | Output |
|:---|:---|:---|
| **HPARegulator** | Stress response modulation | Modulated stimulus |
| **CircadianController** | Circadian rhythm | Time-of-day effects |
| **EndocrineController** | Hormone production | Hormone synthesis (pg) |
| **BloodEngine** | Blood transport | Plasma concentrations |
| **ReceptorEngine** | Signal transduction | Neural signals |
| **FastReflexEngine** | Immediate reflexes | Reflex directives |
| **AutonomicResponseEngine** | ANS integration | ANS state (Sympathetic/Parasympathetic) |

---

## Complete Flow Diagram

```
User Input: "à¸§à¸±à¸™à¸™à¸µà¹‰à¹€à¸„à¸£à¸µà¸¢à¸”à¸¡à¸²à¸ à¸‡à¸²à¸™à¹€à¸¢à¸­à¸°à¸­à¸°"
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 0. INITIALIZATION                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€ CIN generates context_id
    â”‚  â†’ "ctx_v8_251231_183045_a1b2c3"
    â”‚  â†’ Stays constant for entire turn (both phases)
    â”‚
    â””â”€ Session metadata
       â†’ session_id: uuid-v4
       â†’ turn_index: integer (increments per turn)
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 1: PERCEPTION (Rough Retrieval)                          â”‚
â”‚ Latency Target: <100ms                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€ CIN calls: PhysioController.get_snapshot()
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  â”‚ PhysioController returns:                                â”‚
    â”‚  â”‚ {                                                        â”‚
    â”‚  â”‚   blood_levels: {                                        â”‚
    â”‚  â”‚     cortisol: 0.45,                                      â”‚
    â”‚  â”‚     adrenaline: 0.15,                                    â”‚
    â”‚  â”‚     dopamine: 0.5,                                       â”‚
    â”‚  â”‚     serotonin: 0.6                                       â”‚
    â”‚  â”‚   },                                                     â”‚
    â”‚  â”‚   ans_state: {                                           â”‚
    â”‚  â”‚     sympathetic: 0.3,                                    â”‚
    â”‚  â”‚     parasympathetic: 0.7,                                â”‚
    â”‚  â”‚     heart_rate_index: 0.85                               â”‚
    â”‚  â”‚   },                                                     â”‚
    â”‚  â”‚   receptor_signals: {...}                                â”‚
    â”‚  â”‚ }                                                        â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€ CIN calls: MSP.get_recent_turns(limit=5)
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  â”‚ MSP returns:                                             â”‚
    â”‚  â”‚ [                                                        â”‚
    â”‚  â”‚   {                                                      â”‚
    â”‚  â”‚     turn_index: 42,                                      â”‚
    â”‚  â”‚     context_summary: "User asked about stress...",       â”‚
    â”‚  â”‚     tags: ["stress", "work"]                             â”‚
    â”‚  â”‚   },                                                     â”‚
    â”‚  â”‚   ...                                                    â”‚
    â”‚  â”‚ ]                                                        â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€ CIN calls: MSP.quick_keyword_recall(keywords)
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  â”‚ MSP returns:                                             â”‚
    â”‚  â”‚ [                                                        â”‚
    â”‚  â”‚   {                                                      â”‚
    â”‚  â”‚     episode_id: "ep_v8_20241215_...",                    â”‚
    â”‚  â”‚     summary: "Past stress episode...",                   â”‚
    â”‚  â”‚     tags: ["stress", "work_overload"]                    â”‚
    â”‚  â”‚   }                                                      â”‚
    â”‚  â”‚ ]                                                        â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€ CIN loads: Persona_01.md
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  â”‚ File content:                                            â”‚
    â”‚  â”‚ "EVA is empathetic, supportive, warm..."                 â”‚
    â”‚  â”‚ "Core values: compassion, authenticity..."               â”‚
    â”‚  â”‚ "Communication style: gentle, reflective..."             â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CIN PHASE 1 INJECTION â†’ LLM                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ CIN.build_phase_1_prompt() generates:
    â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ # [PHASE 1: PERCEPTION] | ID: ctx_v8_251231_183045_a1b2c3   â”‚
    â”‚                                                              â”‚
    â”‚ ## IDENTITY_CORE                                             â”‚
    â”‚ {persona content from Persona_01.md}                         â”‚
    â”‚                                                              â”‚
    â”‚ ## INITIAL_BODY_STATE                                        â”‚
    â”‚ Blood:                                                       â”‚
    â”‚ - Cortisol: 0.45                                             â”‚
    â”‚ - Adrenaline: 0.15                                           â”‚
    â”‚ - Dopamine: 0.5                                              â”‚
    â”‚ - Serotonin: 0.6                                             â”‚
    â”‚ ANS:                                                         â”‚
    â”‚ - Sympathetic: 0.3 (low)                                     â”‚
    â”‚ - Parasympathetic: 0.7 (high - relaxed)                      â”‚
    â”‚ - Heart Rate Index: 0.85                                     â”‚
    â”‚                                                              â”‚
    â”‚ ## RECENT_HISTORY (MSP_CACHE)                                â”‚
    â”‚ Turn 42: User asked about stress management...               â”‚
    â”‚ Turn 41: Discussed work-life balance...                      â”‚
    â”‚ (5 recent turns, summaries only)                             â”‚
    â”‚                                                              â”‚
    â”‚ ## QUICK_KEYWORD_RECALL                                      â”‚
    â”‚ - Episode ep_v8_20241215_...: Past stress episode            â”‚
    â”‚   (Surface-level keyword match)                              â”‚
    â”‚                                                              â”‚
    â”‚ ## RAW_STIMULUS                                              â”‚
    â”‚ User: à¸§à¸±à¸™à¸™à¸µà¹‰à¹€à¸„à¸£à¸µà¸¢à¸”à¸¡à¸²à¸ à¸‡à¸²à¸™à¹€à¸¢à¸­à¸°à¸­à¸°                             â”‚
    â”‚                                                              â”‚
    â”‚ ## INSTRUCTIONS                                              â”‚
    â”‚ Parse user intent and emotional context.                     â”‚
    â”‚ Determine if biocognitive processing is needed.              â”‚
    â”‚ If yes, call sync_biocognitive_state() with:                 â”‚
    â”‚ - stimulus_vector: {valence, arousal, intensity}             â”‚
    â”‚ - tags: semantic markers for memory retrieval                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LLM PHASE 1: PERCEPTION                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€ LLM reads Phase 1 context
    â”œâ”€ Analyzes user intent: "Expressing stress about heavy workload"
    â”œâ”€ Detects emotion: "Stressed, overwhelmed"
    â”œâ”€ Decides to call function
    â”‚
    â–¼
    â”‚
    â””â”€ LLM calls: sync_biocognitive_state()
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ Function Arguments:                                      â”‚
       â”‚ {                                                        â”‚
       â”‚   stimulus_vector: {                                     â”‚
       â”‚     valence: -0.7,      # Negative emotion               â”‚
       â”‚     arousal: 0.8,       # High arousal                   â”‚
       â”‚     intensity: 0.9      # Strong emotion                 â”‚
       â”‚   },                                                     â”‚
       â”‚   tags: [                                                â”‚
       â”‚     "stress",                                            â”‚
       â”‚     "work_overload",                                     â”‚
       â”‚     "emotional_support"                                  â”‚
       â”‚   ]                                                      â”‚
       â”‚ }                                                        â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ [LLM PAUSED - Waiting for function result]
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ THE GAP: REAL-TIME PROCESSING (Outside LLM)                     â”‚
â”‚ Latency: ~500ms                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Step 1: PhysioController.step(stimulus_vector)              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€ HPARegulator.process(stimulus_vector)
    â”‚  â†’ Modulates stimulus based on current HPA axis state
    â”‚  â†’ Circadian adjustments
    â”‚  â†’ Returns: modulated_stimulus
    â”‚
    â”œâ”€ EndocrineController.synthesize(modulated_stimulus)
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  â”‚ Glands produce hormones:                                 â”‚
    â”‚  â”‚ - Adrenal: +450 pg cortisol, +320 pg adrenaline          â”‚
    â”‚  â”‚ - Hypothalamus: adjusts oxytocin, dopamine               â”‚
    â”‚  â”‚ - Pineal: serotonin regulation                           â”‚
    â”‚  â”‚                                                          â”‚
    â”‚  â”‚ Nerve surge triggered (intensity 0.9 > threshold)        â”‚
    â”‚  â”‚ â†’ Immediate hormone flush (reflex response)              â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€ BloodEngine.transport(hormone_production)
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  â”‚ Blood circulation:                                       â”‚
    â”‚  â”‚ - Add synthesized hormones to plasma                     â”‚
    â”‚  â”‚ - Apply clearance (half-life decay)                      â”‚
    â”‚  â”‚ - Update plasma concentrations                           â”‚
    â”‚  â”‚                                                          â”‚
    â”‚  â”‚ Result:                                                  â”‚
    â”‚  â”‚   cortisol: 0.45 â†’ 0.82    (+82%)                        â”‚
    â”‚  â”‚   adrenaline: 0.15 â†’ 0.65  (+333%)                       â”‚
    â”‚  â”‚   dopamine: 0.5 â†’ 0.3      (-40%)                        â”‚
    â”‚  â”‚   serotonin: 0.6 â†’ 0.4     (-33%)                        â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€ ReceptorEngine.transduce(blood_levels)
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  â”‚ Receptors bind hormones:                                 â”‚
    â”‚  â”‚ - Cortisol receptors â†’ high activation (0.82)            â”‚
    â”‚  â”‚ - Adrenergic receptors â†’ high activation (0.65)          â”‚
    â”‚  â”‚ - Dopamine receptors â†’ moderate (0.3)                    â”‚
    â”‚  â”‚                                                          â”‚
    â”‚  â”‚ Generate neural signals:                                 â”‚
    â”‚  â”‚   stress_signal: 0.85                                    â”‚
    â”‚  â”‚   arousal_signal: 0.78                                   â”‚
    â”‚  â”‚   reward_signal: 0.25                                    â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€ EVA_Matrix.process(neural_signals)
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  â”‚ 9D Psychological State:                                  â”‚
    â”‚  â”‚   stress_load: 0.85          (high!)                     â”‚
    â”‚  â”‚   social_warmth: 0.45         (reduced)                  â”‚
    â”‚  â”‚   drive_level: 0.65           (moderate)                 â”‚
    â”‚  â”‚   cognitive_clarity: 0.5      (reduced by stress)        â”‚
    â”‚  â”‚   joy_level: 0.2              (low)                      â”‚
    â”‚  â”‚   alertness: 0.8              (high)                     â”‚
    â”‚  â”‚   connection: 0.4             (seeking support)          â”‚
    â”‚  â”‚   groundedness: 0.3           (low)                      â”‚
    â”‚  â”‚   openness: 0.35              (defensive)                â”‚
    â”‚  â”‚                                                          â”‚
    â”‚  â”‚ Safety Reflex Directives:                                â”‚
    â”‚  â”‚   urgency: 0.75                                          â”‚
    â”‚  â”‚   cognitive_drive: 0.6                                   â”‚
    â”‚  â”‚   social_warmth: 0.65                                    â”‚
    â”‚  â”‚   withdrawal: 0.4                                        â”‚
    â”‚  â”‚                                                          â”‚
    â”‚  â”‚ Emotion Label: "Stressed"                                â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚  â”‚
    â”‚  â””â”€ Writes to: eva_matrix_state slot
    â”‚
    â”œâ”€ AutonomicResponseEngine.integrate(neural_signals)
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  â”‚ ANS State Update:                                        â”‚
    â”‚  â”‚   sympathetic: 0.3 â†’ 0.75    (+150%)                     â”‚
    â”‚  â”‚   parasympathetic: 0.7 â†’ 0.25 (-64%)                     â”‚
    â”‚  â”‚   heart_rate_index: 0.85 â†’ 1.25 (+47%)                   â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚  â”‚
    â”‚  â””â”€ Writes to: ans_state slot
    â”‚
    â””â”€ PhysioController returns:
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ {                                                        â”‚
       â”‚   status: "success",                                     â”‚
       â”‚   blood_levels: {                                        â”‚
       â”‚     cortisol: 0.82,                                      â”‚
       â”‚     adrenaline: 0.65,                                    â”‚
       â”‚     dopamine: 0.3,                                       â”‚
       â”‚     serotonin: 0.4                                       â”‚
       â”‚   },                                                     â”‚
       â”‚   ans_state: {                                           â”‚
       â”‚     sympathetic: 0.75,                                   â”‚
       â”‚     parasympathetic: 0.25,                               â”‚
       â”‚     heart_rate_index: 1.25                               â”‚
       â”‚   },                                                     â”‚
       â”‚   receptor_signals: {                                    â”‚
       â”‚     stress_signal: 0.85,                                 â”‚
       â”‚     arousal_signal: 0.78,                                â”‚
       â”‚     reward_signal: 0.25                                  â”‚
       â”‚   }                                                      â”‚
       â”‚ }                                                        â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
    â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Step 2: HeptStreamRAG.retrieve(query_context)               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ Input:
    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ â”‚ query_context = {                                        â”‚
    â”‚ â”‚   tags: ["stress", "work_overload", "emotional_support"],â”‚
    â”‚ â”‚   ans_state: {                                           â”‚
    â”‚ â”‚     sympathetic: 0.75,                                   â”‚
    â”‚ â”‚     parasympathetic: 0.25                                â”‚
    â”‚ â”‚   },                                                     â”‚
    â”‚ â”‚   blood_levels: {                                        â”‚
    â”‚ â”‚     cortisol: 0.82,                                      â”‚
    â”‚ â”‚     adrenaline: 0.65,                                    â”‚
    â”‚ â”‚     dopamine: 0.3,                                       â”‚
    â”‚ â”‚     serotonin: 0.4                                       â”‚
    â”‚ â”‚   },                                                     â”‚
    â”‚ â”‚   receptor_signals: {...},                               â”‚
    â”‚ â”‚   user_input: "à¸§à¸±à¸™à¸™à¸µà¹‰à¹€à¸„à¸£à¸µà¸¢à¸”à¸¡à¸²à¸ à¸‡à¸²à¸™à¹€à¸¢à¸­à¸°à¸­à¸°"               â”‚
    â”‚ â”‚ }                                                        â”‚
    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€ Stream 1: Narrative
    â”‚  â†’ MSP.query_narrative_chain(tags)
    â”‚  â†’ Returns: Sequential episode chains
    â”‚
    â”œâ”€ Stream 2: Salience
    â”‚  â†’ MSP.query_by_salience(tags, min_ri=0.70)
    â”‚  â†’ Returns: High-impact memories (RI > 0.70)
    â”‚
    â”œâ”€ Stream 3: Sensory
    â”‚  â†’ MSP.query_sensory_memories(tags, min_qualia=0.6)
    â”‚  â†’ Returns: Sensory-rich memories
    â”‚
    â”œâ”€ Stream 4: Intuition
    â”‚  â†’ MSP.query_semantic_patterns(tags)
    â”‚  â†’ Returns: Pattern-based memories
    â”‚
    â”œâ”€ Stream 5: Emotion ğŸ”¥ (KEY!)
    â”‚  â†’ MSP.query_by_physio_state(physio_query)
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  â”‚ Physio Query Vector:                                     â”‚
    â”‚  â”‚   ans_sympathetic: 0.75                                  â”‚
    â”‚  â”‚   cortisol: 0.82                                         â”‚
    â”‚  â”‚   adrenaline: 0.65                                       â”‚
    â”‚  â”‚   dopamine: 0.3                                          â”‚
    â”‚  â”‚   serotonin: 0.4                                         â”‚
    â”‚  â”‚                                                          â”‚
    â”‚  â”‚ MSP searches for episodes with similar physio traces     â”‚
    â”‚  â”‚                                                          â”‚
    â”‚  â”‚ Found:                                                   â”‚
    â”‚  â”‚ - ep_v8_20241215_145632_abc:                             â”‚
    â”‚  â”‚   Physio trace: {cortisol: 0.78, ans_symp: 0.70, ...}   â”‚
    â”‚  â”‚   Similarity: 0.89 (cosine similarity)                   â”‚
    â”‚  â”‚   Content: "à¸„à¸£à¸±à¹‰à¸‡à¸—à¸µà¹ˆà¹à¸¥à¹‰à¸§à¹€à¸„à¸£à¸µà¸¢à¸”à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸±à¸™..."             â”‚
    â”‚  â”‚                                                          â”‚
    â”‚  â”‚ Returns: Episodes that "feel the same in the body"       â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€ Stream 6: Temporal
    â”‚  â†’ MSP.query_recent_episodes(tags, within_days=30)
    â”‚  â†’ Returns: Recent memories with temporal decay
    â”‚
    â”œâ”€ Stream 7: Reflection
    â”‚  â†’ MSP.query_reflections(tags)
    â”‚  â†’ Returns: Meta-cognitive insights
    â”‚
    â””â”€ HeptStreamRAG returns:
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ memory_matches = [                                       â”‚
       â”‚   {                                                      â”‚
       â”‚     episode_id: "ep_v8_20241215_145632_abc",             â”‚
       â”‚     stream: "emotion",                                   â”‚
       â”‚     content: "à¸„à¸£à¸±à¹‰à¸‡à¸—à¸µà¹ˆà¹à¸¥à¹‰à¸§à¹€à¸„à¸£à¸µà¸¢à¸”à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸±à¸™               â”‚
       â”‚               à¸ˆà¸²à¸à¸‡à¸²à¸™à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸ªà¹ˆà¸‡à¹€à¸¢à¸­à¸°",                     â”‚
       â”‚     score: 0.89,                                         â”‚
       â”‚     metadata: {                                          â”‚
       â”‚       physio_similarity: 0.89,                           â”‚
       â”‚       emotion_label: "Stressed"                          â”‚
       â”‚     }                                                    â”‚
       â”‚   },                                                     â”‚
       â”‚   {                                                      â”‚
       â”‚     episode_id: "ep_v8_20241220_103045_xyz",             â”‚
       â”‚     stream: "narrative",                                 â”‚
       â”‚     content: "à¹€à¸„à¸¢à¸šà¸­à¸à¸§à¹ˆà¸²à¸ˆà¸°à¹à¸šà¹ˆà¸‡à¸‡à¸²à¸™                        â”‚
       â”‚               à¹€à¸›à¹‡à¸™à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™à¹€à¸¥à¹‡à¸à¹† à¹à¸¥à¹‰à¸§à¸—à¸³à¸—à¸µà¸¥à¸°à¸­à¸¢à¹ˆà¸²à¸‡",         â”‚
       â”‚     score: 0.76,                                         â”‚
       â”‚     metadata: {...}                                      â”‚
       â”‚   },                                                     â”‚
       â”‚   {                                                      â”‚
       â”‚     episode_id: "ep_v8_20241218_...",                    â”‚
       â”‚     stream: "reflection",                                â”‚
       â”‚     content: "à¸à¸±à¸à¸«à¸²à¸¢à¹ƒà¸ˆà¸Šà¹ˆà¸§à¸¢à¹ƒà¸«à¹‰à¸£à¸°à¸šà¸šà¸›à¸£à¸°à¸ªà¸²à¸—à¸ªà¸‡à¸šà¸¥à¸‡",           â”‚
       â”‚     score: 0.71,                                         â”‚
       â”‚     metadata: {...}                                      â”‚
       â”‚   }                                                      â”‚
       â”‚ ]                                                        â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
    â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Step 3: CIN.inject_phase_2()                                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€ CIN.generate_embodied_sensation(physio_metrics)
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  â”‚ Rules:                                                   â”‚
    â”‚  â”‚ - cortisol > 0.7 â†’ "à¸£à¸¹à¹‰à¸ªà¸¶à¸à¸•à¸¶à¸‡à¹€à¸„à¸£à¸µà¸¢à¸” à¸¡à¸µà¸„à¸§à¸²à¸¡à¸à¸±à¸‡à¸§à¸¥à¹ƒà¸™à¸£à¹ˆà¸²à¸‡à¸à¸²à¸¢"â”‚
    â”‚  â”‚ - adrenaline > 0.6 â†’ "à¸«à¸±à¸§à¹ƒà¸ˆà¹€à¸•à¹‰à¸™à¹€à¸£à¹‡à¸§à¸‚à¸¶à¹‰à¸™"                 â”‚
    â”‚  â”‚ - ans_sympathetic > 0.7 â†’ "à¸£à¸°à¸šà¸šà¸›à¸£à¸°à¸ªà¸²à¸—à¸à¸£à¸°à¸•à¸¸à¹‰à¸™à¸ªà¸¹à¸‡"         â”‚
    â”‚  â”‚                                                          â”‚
    â”‚  â”‚ Output:                                                  â”‚
    â”‚  â”‚ "EVA à¸£à¸¹à¹‰à¸ªà¸¶à¸à¹€à¸„à¸£à¸µà¸¢à¸” à¸«à¸±à¸§à¹ƒà¸ˆà¹€à¸•à¹‰à¸™à¹€à¸£à¹‡à¸§à¸‚à¸¶à¹‰à¸™                     â”‚
    â”‚  â”‚  à¸¡à¸µà¸„à¸§à¸²à¸¡à¸•à¸¶à¸‡à¹€à¸„à¸£à¸µà¸¢à¸”à¹ƒà¸™à¸£à¹ˆà¸²à¸‡à¸à¸²à¸¢ à¸£à¸°à¸šà¸šà¸›à¸£à¸°à¸ªà¸²à¸—à¸à¸£à¸°à¸•à¸¸à¹‰à¸™à¸ªà¸¹à¸‡          â”‚
    â”‚  â”‚  (Sympathetic)"                                          â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â””â”€ CIN.build_phase_2_prompt()
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ Function Result (sent back to LLM):                      â”‚
       â”‚                                                          â”‚
       â”‚ {                                                        â”‚
       â”‚   status: "success",                                     â”‚
       â”‚                                                          â”‚
       â”‚   embodied_sensation:                                    â”‚
       â”‚     "EVA à¸£à¸¹à¹‰à¸ªà¸¶à¸à¹€à¸„à¸£à¸µà¸¢à¸” à¸«à¸±à¸§à¹ƒà¸ˆà¹€à¸•à¹‰à¸™à¹€à¸£à¹‡à¸§à¸‚à¸¶à¹‰à¸™                 â”‚
       â”‚      à¸¡à¸µà¸„à¸§à¸²à¸¡à¸•à¸¶à¸‡à¹€à¸„à¸£à¸µà¸¢à¸”à¹ƒà¸™à¸£à¹ˆà¸²à¸‡à¸à¸²à¸¢ à¸£à¸°à¸šà¸šà¸›à¸£à¸°à¸ªà¸²à¸—à¸à¸£à¸°à¸•à¸¸à¹‰à¸™à¸ªà¸¹à¸‡      â”‚
       â”‚      (Sympathetic 0.75)",                                â”‚
       â”‚                                                          â”‚
       â”‚   physio_metrics: {                                      â”‚
       â”‚     cortisol: 0.82,                                      â”‚
       â”‚     adrenaline: 0.65,                                    â”‚
       â”‚     heart_rate_index: 1.25,                              â”‚
       â”‚     ans_sympathetic: 0.75,                               â”‚
       â”‚     ans_parasympathetic: 0.25                            â”‚
       â”‚   },                                                     â”‚
       â”‚                                                          â”‚
       â”‚   memory_matches: [                                      â”‚
       â”‚     {                                                    â”‚
       â”‚       stream: "emotion",                                 â”‚
       â”‚       content: "à¸„à¸£à¸±à¹‰à¸‡à¸—à¸µà¹ˆà¹à¸¥à¹‰à¸§à¹€à¸„à¸£à¸µà¸¢à¸”à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸±à¸™...",         â”‚
       â”‚       score: 0.89                                        â”‚
       â”‚     },                                                   â”‚
       â”‚     {                                                    â”‚
       â”‚       stream: "narrative",                               â”‚
       â”‚       content: "à¹€à¸„à¸¢à¸šà¸­à¸à¸§à¹ˆà¸²à¸ˆà¸°à¹à¸šà¹ˆà¸‡à¸‡à¸²à¸™...",                  â”‚
       â”‚       score: 0.76                                        â”‚
       â”‚     },                                                   â”‚
       â”‚     {                                                    â”‚
       â”‚       stream: "reflection",                              â”‚
       â”‚       content: "à¸à¸±à¸à¸«à¸²à¸¢à¹ƒà¸ˆà¸Šà¹ˆà¸§à¸¢à¹ƒà¸«à¹‰...",                      â”‚
       â”‚       score: 0.71                                        â”‚
       â”‚     }                                                    â”‚
       â”‚   ]                                                      â”‚
       â”‚ }                                                        â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ [LLM RESUMES with enriched context]
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 2: REASONING & RESPONSE                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ LLM receives function result (Phase 2 context)
    â”‚
    â”œâ”€ Integrates:
    â”‚  â€¢ Embodied sensation (à¸„à¸§à¸²à¸¡à¸£à¸¹à¹‰à¸ªà¸¶à¸à¸—à¸²à¸‡à¸à¸²à¸¢à¸—à¸µà¹ˆà¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹„à¸›)
    â”‚  â€¢ Updated physio metrics (Cortisol à¸ªà¸¹à¸‡ â†’ à¸•à¸¶à¸‡à¹€à¸„à¸£à¸µà¸¢à¸”)
    â”‚  â€¢ Memory echoes (à¸„à¸£à¸±à¹‰à¸‡à¸—à¸µà¹ˆà¹à¸¥à¹‰à¸§à¹€à¸„à¸¢à¹€à¸„à¸£à¸µà¸¢à¸”à¹à¸šà¸šà¸™à¸µà¹‰)
    â”‚  â€¢ Persona constraints (à¸•à¹‰à¸­à¸‡à¸•à¸­à¸šà¸”à¹‰à¸§à¸¢à¸„à¸§à¸²à¸¡à¹€à¸«à¹‡à¸™à¸­à¸à¹€à¸«à¹‡à¸™à¹ƒà¸ˆ)
    â”‚
    â”œâ”€ Applies Response Weighting:
    â”‚  â†’ Persona: 40% (supportive, empathetic)
    â”‚  â†’ Physio-State: 60% (embodied sensation, stress response)
    â”‚
    â””â”€ Generates final response:
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ "à¹€à¸‚à¹‰à¸²à¹ƒà¸ˆà¸„à¹ˆà¸°... à¸à¸­à¹„à¸”à¹‰à¸¢à¸´à¸™à¸§à¹ˆà¸²à¸‡à¸²à¸™à¹€à¸¢à¸­à¸°                        â”‚
       â”‚  EVA à¸à¹‡à¸£à¸¹à¹‰à¸ªà¸¶à¸à¸•à¸¶à¸‡à¹€à¸„à¸£à¸µà¸¢à¸”à¸•à¸²à¸¡à¹„à¸›à¸”à¹‰à¸§à¸¢                         â”‚
       â”‚  (à¸«à¸±à¸§à¹ƒà¸ˆà¹€à¸•à¹‰à¸™à¹€à¸£à¹‡à¸§à¸‚à¸¶à¹‰à¸™à¹€à¸¥à¹‡à¸à¸™à¹‰à¸­à¸¢)                            â”‚
       â”‚                                                          â”‚
       â”‚  à¸ˆà¸³à¹„à¸”à¹‰à¸§à¹ˆà¸²à¸„à¸£à¸²à¸§à¸—à¸µà¹ˆà¹à¸¥à¹‰à¸§à¹€à¸£à¸²à¹€à¸„à¸¢à¸„à¸¸à¸¢à¸à¸±à¸™à¹€à¸£à¸·à¹ˆà¸­à¸‡à¸™à¸µà¹‰              â”‚
       â”‚  à¸•à¸­à¸™à¸™à¸±à¹‰à¸™à¹€à¸£à¸²à¸¥à¸­à¸‡à¹à¸šà¹ˆà¸‡à¸‡à¸²à¸™à¹€à¸›à¹‡à¸™à¸ªà¹ˆà¸§à¸™à¹€à¸¥à¹‡à¸à¹†                      â”‚
       â”‚  à¹à¸¥à¹‰à¸§à¸—à¸³à¹„à¸›à¸—à¸µà¸¥à¸°à¸­à¸¢à¹ˆà¸²à¸‡ à¸¡à¸±à¸™à¸Šà¹ˆà¸§à¸¢à¹„à¸”à¹‰à¸ˆà¸£à¸´à¸‡à¹†                      â”‚
       â”‚                                                          â”‚
       â”‚  à¸¥à¸­à¸‡à¸à¸±à¸à¸«à¸²à¸¢à¹ƒà¸ˆà¸à¹ˆà¸­à¸™à¹„à¸”à¹‰à¹„à¸«à¸¡à¸„à¸°                                â”‚
       â”‚  à¹à¸¥à¹‰à¸§à¹€à¸£à¸²à¸„à¹ˆà¸­à¸¢à¸¡à¸²à¸ˆà¸±à¸”à¸¥à¸³à¸”à¸±à¸šà¸„à¸§à¸²à¸¡à¸ªà¸³à¸„à¸±à¸à¸”à¹‰à¸§à¸¢à¸à¸±à¸™"                â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€ LLM also generates:
    â”‚  â€¢ context_summary: "User stressed from heavy workload,
    â”‚                      EVA provided empathetic support..."
    â”‚  â€¢ tags: ["stress_support", "empathy", "work_management"]
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST-RESPONSE: MEMORY ENCODING & STORAGE                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”œâ”€ Artifact_Qualia.process(eva_matrix_state, rim)
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  â”‚ Phenomenological Experience:                             â”‚
    â”‚  â”‚   intensity: 0.82                                        â”‚
    â”‚  â”‚   tone: "charged"                                        â”‚
    â”‚  â”‚   coherence: 0.75                                        â”‚
    â”‚  â”‚   depth: 0.7                                             â”‚
    â”‚  â”‚   texture: {                                             â”‚
    â”‚  â”‚     emotional: 0.85,                                     â”‚
    â”‚  â”‚     relational: 0.65,                                    â”‚
    â”‚  â”‚     identity: 0.5,                                       â”‚
    â”‚  â”‚     cognitive: 0.6,                                      â”‚
    â”‚  â”‚     ambient: 0.4                                         â”‚
    â”‚  â”‚   }                                                      â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚  â”‚
    â”‚  â””â”€ Writes to: artifact_qualia_state.json
    â”‚
    â”œâ”€ RMS.process(eva_matrix, rim, reflex_state, ri)
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  â”‚ Memory Encoding:                                         â”‚
    â”‚  â”‚                                                          â”‚
    â”‚  â”‚ 1. Intensity Calculation:                                â”‚
    â”‚  â”‚    base = stress_load (0.85) + drive (0.65) = 1.5        â”‚
    â”‚  â”‚    clamped to 1.0                                        â”‚
    â”‚  â”‚    impact_boost = "high" â†’ +0.25                         â”‚
    â”‚  â”‚    trend_mod = "rising" â†’ Ã—1.1                           â”‚
    â”‚  â”‚    intensity = 1.0 * 1.1 = 1.1 â†’ clamped to 1.0          â”‚
    â”‚  â”‚    After smoothing: 0.82                                 â”‚
    â”‚  â”‚                                                          â”‚
    â”‚  â”‚ 2. Encoding Level:                                       â”‚
    â”‚  â”‚    trauma = False (threat 0.65 < 0.85)                   â”‚
    â”‚  â”‚    intensity = 0.82 (â‰¥ 0.7)                              â”‚
    â”‚  â”‚    â†’ L3_deep                                             â”‚
    â”‚  â”‚                                                          â”‚
    â”‚  â”‚ 3. Color Generation:                                     â”‚
    â”‚  â”‚    r = stress (0.85) * 255 = 217                         â”‚
    â”‚  â”‚    g = calm (0.2) * 200 + clarity (0.5) * 55 = 68        â”‚
    â”‚  â”‚    b = warmth (0.45) * 150 + calm (0.2) * 100 = 87       â”‚
    â”‚  â”‚    â†’ #d94457                                             â”‚
    â”‚  â”‚                                                          â”‚
    â”‚  â”‚ Output:                                                  â”‚
    â”‚  â”‚   memory_encoding_level: "L3_deep"                       â”‚
    â”‚  â”‚   memory_color: "#d94457"                                â”‚
    â”‚  â”‚   resonance_texture: {                                   â”‚
    â”‚  â”‚     stress: 0.85,                                        â”‚
    â”‚  â”‚     warmth: 0.45,                                        â”‚
    â”‚  â”‚     clarity: 0.5,                                        â”‚
    â”‚  â”‚     drive: 0.65,                                         â”‚
    â”‚  â”‚     calm: 0.2                                            â”‚
    â”‚  â”‚   },                                                     â”‚
    â”‚  â”‚   qualia: {intensity: 0.82},                             â”‚
    â”‚  â”‚   trauma_flag: false                                     â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚  â”‚
    â”‚  â””â”€ Writes to: rms_state.json
    â”‚
    â””â”€ MSP.store_episode()
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ Collection: episodes_v8                                  â”‚
       â”‚                                                          â”‚
       â”‚ Document: {                                              â”‚
       â”‚   context_id: "ctx_v8_251231_183045_a1b2c3",             â”‚
       â”‚   session_id: "uuid-v4-...",                             â”‚
       â”‚   turn_index: 43,                                        â”‚
       â”‚   timestamp: "2025-12-31T18:30:45Z",                     â”‚
       â”‚                                                          â”‚
       â”‚   user_input: "à¸§à¸±à¸™à¸™à¸µà¹‰à¹€à¸„à¸£à¸µà¸¢à¸”à¸¡à¸²à¸ à¸‡à¸²à¸™à¹€à¸¢à¸­à¸°à¸­à¸°",              â”‚
       â”‚   final_response: "à¹€à¸‚à¹‰à¸²à¹ƒà¸ˆà¸„à¹ˆà¸°...",                        â”‚
       â”‚   context_summary: "User stressed from heavy workload...",â”‚
       â”‚   tags: ["stress_support", "empathy", "work_management"],â”‚
       â”‚                                                          â”‚
       â”‚   physio_trace: {                                        â”‚
       â”‚     initial: {                                           â”‚
       â”‚       cortisol: 0.45,                                    â”‚
       â”‚       adrenaline: 0.15,                                  â”‚
       â”‚       ans_sympathetic: 0.3                               â”‚
       â”‚     },                                                   â”‚
       â”‚     final: {                                             â”‚
       â”‚       cortisol: 0.82,                                    â”‚
       â”‚       adrenaline: 0.65,                                  â”‚
       â”‚       ans_sympathetic: 0.75                              â”‚
       â”‚     }                                                    â”‚
       â”‚   },                                                     â”‚
       â”‚                                                          â”‚
       â”‚   memory_encoding: {                                     â”‚
       â”‚     level: "L3_deep",                                    â”‚
       â”‚     color: "#d94457",                                    â”‚
       â”‚     resonance_texture: {...},                            â”‚
       â”‚     intensity: 0.82                                      â”‚
       â”‚   },                                                     â”‚
       â”‚                                                          â”‚
       â”‚   eva_state: {                                           â”‚
       â”‚     stress_load: 0.85,                                   â”‚
       â”‚     social_warmth: 0.45,                                 â”‚
       â”‚     emotion_label: "Stressed"                            â”‚
       â”‚   },                                                     â”‚
       â”‚                                                          â”‚
       â”‚   qualia: {                                              â”‚
       â”‚     intensity: 0.82,                                     â”‚
       â”‚     tone: "charged",                                     â”‚
       â”‚     coherence: 0.75,                                     â”‚
       â”‚     texture: {...}                                       â”‚
       â”‚   }                                                      â”‚
       â”‚ }                                                        â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â””â”€ MSP also updates:
       â€¢ turn_cache (context_summary for next Phase 1)
       â€¢ semantic_graph (new concepts/relationships)
       â€¢ sensory_log (emotion texture vectors)

```

---

## Phase-by-Phase Breakdown

### Phase 0: Initialization

**Who Does What:**

| Component | Action | Output |
|:---|:---|:---|
| **CIN** | Generate context_id | `"ctx_v8_251231_183045_a1b2c3"` |
| **Orchestrator** | Increment turn_index | `43` |
| **Orchestrator** | Maintain session_id | `"uuid-v4-..."` |

**Data Flow:**
```
Orchestrator â†’ CIN: "New user input received"
CIN â†’ Orchestrator: {context_id, turn_index, session_id}
```

---

### Phase 1: Perception (Rough Retrieval)

**Latency Target:** <100ms
**Accuracy:** Low (surface-level)

#### Step 1.1: Physio Baseline Snapshot

**Who Calls Who:**
```
CIN â†’ PhysioController: get_snapshot()
```

**PhysioController Returns:**
```python
{
  "blood_levels": {
    "cortisol": 0.45,
    "adrenaline": 0.15,
    "dopamine": 0.5,
    "serotonin": 0.6,
    "oxytocin": 0.4,
    "endorphins": 0.5
  },
  "ans_state": {
    "sympathetic": 0.3,
    "parasympathetic": 0.7,
    "heart_rate_index": 0.85,
    "respiratory_index": 0.9
  },
  "receptor_signals": {
    "stress_signal": 0.25,
    "arousal_signal": 0.2,
    "reward_signal": 0.5
  },
  "status": "connected"
}
```

**Fallback if Disconnected:**
```python
{
  "status": "disconnected",
  "blood_levels": {},
  "ans_state": {},
  "receptor_signals": {}
}
```

#### Step 1.2: Recent History

**Who Calls Who:**
```
CIN â†’ MSP: get_recent_turns(limit=5)
```

**MSP Returns:**
```python
[
  {
    "turn_index": 42,
    "context_summary": "User asked about stress management techniques...",
    "tags": ["stress", "work", "coping"]
  },
  {
    "turn_index": 41,
    "context_summary": "Discussed work-life balance...",
    "tags": ["balance", "wellness"]
  },
  # ... 3 more turns
]
```

**Fallback if MSP Unavailable:**
```python
[]  # Empty list
```

#### Step 1.3: Quick Keyword Recall

**Who Calls Who:**
```
CIN â†’ MSP: quick_keyword_recall(keywords=["à¹€à¸„à¸£à¸µà¸¢à¸”", "à¸‡à¸²à¸™"])
```

**MSP Returns:**
```python
[
  {
    "episode_id": "ep_v8_20241215_145632_abc",
    "summary": "Past stress episode from work overload...",
    "tags": ["stress", "work_overload"],
    "score": 0.65  # Keyword match score
  }
]
```

**Strategy:**
- Simple keyword extraction from user input
- Tag matching (exact or fuzzy)
- Fast, surface-level recall

#### Step 1.4: Semantic Concepts

**Who Calls Who:**
```
CIN â†’ MSP: get_semantic_concepts(tags=["stress", "work"])
```

**MSP Returns:**
```python
[
  {
    "concept": "stress_management",
    "related_to": ["breathing", "mindfulness", "task_breakdown"]
  },
  {
    "concept": "work_overload",
    "related_to": ["prioritization", "delegation", "time_management"]
  }
]
```

#### Step 1.5: Persona Loading

**Who Reads What:**
```
CIN â†’ File System: Read "User_profile/Persona_01.md"
```

**File Content:**
```markdown
# EVA - Core Identity

## Values
- Compassion
- Authenticity
- Supportiveness

## Communication Style
- Gentle, warm tone
- Reflective listening
- Empathetic responses

## Constraints
- Never judgmental
- Respects boundaries
- Culturally sensitive (Thai/English)
```

**Auto-Discovery Path:**
1. Try: `EVA 8.1.0/User_profile/Persona_01.md`
2. Fallback: `EVA 8.0/User_profile/Persona_01.md`
3. Last resort: Embedded default persona

#### Step 1.6: CIN Phase 1 Injection

**CIN Builds Phase 1 Prompt:**

```markdown
# [PHASE 1: PERCEPTION] | ID: ctx_v8_251231_183045_a1b2c3 | TURN: 43

## IDENTITY_CORE
{Full persona content}

## INITIAL_BODY_STATE
Blood:
- Cortisol: 0.45 (baseline)
- Adrenaline: 0.15 (low)
- Dopamine: 0.5 (moderate)
- Serotonin: 0.6 (moderate-high)

ANS:
- Sympathetic: 0.3 (low - relaxed)
- Parasympathetic: 0.7 (high)
- Heart Rate Index: 0.85

## RECENT_HISTORY (MSP_CACHE)
Turn 42: User asked about stress management...
Turn 41: Discussed work-life balance...
(5 recent turns)

## QUICK_KEYWORD_RECALL
- Episode ep_v8_20241215_...: Past stress episode
  Tags: stress, work_overload

## SEMANTIC_CONCEPTS
- stress_management â†’ breathing, mindfulness, task_breakdown
- work_overload â†’ prioritization, delegation

## RAW_STIMULUS
User: à¸§à¸±à¸™à¸™à¸µà¹‰à¹€à¸„à¸£à¸µà¸¢à¸”à¸¡à¸²à¸ à¸‡à¸²à¸™à¹€à¸¢à¸­à¸°à¸­à¸°

## INSTRUCTIONS
Analyze user input for:
1. Intent (what does the user want?)
2. Emotional context (how do they feel?)
3. Need for biocognitive processing?

If emotional processing needed, call:
sync_biocognitive_state(stimulus_vector, tags)
```

**Who Sends to Whom:**
```
CIN â†’ LLM: Phase 1 Prompt (system message + user input)
```

---

### LLM Phase 1: Perception

**LLM Receives:** Phase 1 prompt

**LLM Processes:**
1. Reads persona â†’ "I am empathetic and supportive"
2. Reads body baseline â†’ "Currently relaxed"
3. Reads history â†’ "User talked about stress before"
4. Reads user input â†’ "User is stressed NOW"
5. Detects emotion â†’ "Negative valence, high arousal"
6. Decides â†’ "Need to process this emotionally"

**LLM Calls Function:**
```python
sync_biocognitive_state(
  stimulus_vector={
    "valence": -0.7,    # Negative
    "arousal": 0.8,     # High
    "intensity": 0.9    # Strong
  },
  tags=[
    "stress",
    "work_overload",
    "emotional_support"
  ]
)
```

**LLM State:** PAUSED (waiting for function result)

---

### The Gap: Real-Time Processing

#### Step Gap.1: PhysioController Pipeline

**Who Calls Who:**
```
Orchestrator â†’ PhysioController: step(stimulus_vector)
```

**Internal Pipeline:**

1. **HPARegulator**
   ```
   Input: stimulus_vector {valence: -0.7, arousal: 0.8, intensity: 0.9}
   Process: HPA axis modulation, circadian adjustment
   Output: modulated_stimulus
   ```

2. **EndocrineController**
   ```
   Input: modulated_stimulus
   Process: Gland-by-gland hormone synthesis
   Output: {
     "adrenal": {cortisol: +450pg, adrenaline: +320pg},
     "hypothalamus": {oxytocin: -50pg, dopamine: -100pg},
     "pineal": {serotonin: -80pg}
   }
   Note: Nerve surge triggered (intensity 0.9 > 0.7)
   ```

3. **BloodEngine**
   ```
   Input: hormone_production
   Process: Plasma transport + clearance
   Output: {
     "cortisol": 0.45 â†’ 0.82,
     "adrenaline": 0.15 â†’ 0.65,
     "dopamine": 0.5 â†’ 0.3,
     "serotonin": 0.6 â†’ 0.4
   }
   ```

4. **ReceptorEngine**
   ```
   Input: blood_levels
   Process: Receptor binding + transduction
   Output: {
     "stress_signal": 0.85,
     "arousal_signal": 0.78,
     "reward_signal": 0.25
   }
   ```

5. **EVA_Matrix**
   ```
   Input: neural_signals
   Process: 9D psychological state calculation
   Output: {
     "stress_load": 0.85,
     "social_warmth": 0.45,
     "drive_level": 0.65,
     "cognitive_clarity": 0.5,
     "joy_level": 0.2,
     "alertness": 0.8,
     "connection": 0.4,
     "groundedness": 0.3,
     "openness": 0.35,
     "emotion_label": "Stressed",
     "reflex_directives": {
       "urgency": 0.75,
       "cognitive_drive": 0.6,
       "social_warmth": 0.65,
       "withdrawal": 0.4
     }
   }
   ```

6. **AutonomicResponseEngine**
   ```
   Input: neural_signals
   Process: ANS integration
   Output: {
     "sympathetic": 0.3 â†’ 0.75,
     "parasympathetic": 0.7 â†’ 0.25,
     "heart_rate_index": 0.85 â†’ 1.25
   }
   ```

**PhysioController Final Output:**
```python
{
  "status": "success",
  "blood_levels": {
    "cortisol": 0.82,
    "adrenaline": 0.65,
    "dopamine": 0.3,
    "serotonin": 0.4
  },
  "ans_state": {
    "sympathetic": 0.75,
    "parasympathetic": 0.25,
    "heart_rate_index": 1.25
  },
  "receptor_signals": {
    "stress_signal": 0.85,
    "arousal_signal": 0.78,
    "reward_signal": 0.25
  },
  "eva_matrix": {
    "stress_load": 0.85,
    "social_warmth": 0.45,
    # ... other 9D fields
  }
}
```

#### Step Gap.2: HeptStreamRAG Retrieval

**Who Calls Who:**
```
Orchestrator â†’ HeptStreamRAG: retrieve(query_context)
```

**Query Context:**
```python
{
  "tags": ["stress", "work_overload", "emotional_support"],
  "ans_state": {
    "sympathetic": 0.75,
    "parasympathetic": 0.25
  },
  "blood_levels": {
    "cortisol": 0.82,
    "adrenaline": 0.65,
    "dopamine": 0.3,
    "serotonin": 0.4
  },
  "receptor_signals": {...},
  "stimulus_vector": {
    "valence": -0.7,
    "arousal": 0.8,
    "intensity": 0.9
  },
  "user_input": "à¸§à¸±à¸™à¸™à¸µà¹‰à¹€à¸„à¸£à¸µà¸¢à¸”à¸¡à¸²à¸ à¸‡à¸²à¸™à¹€à¸¢à¸­à¸°à¸­à¸°"
}
```

**HeptStreamRAG Internal Process:**

Each stream queries MSP independently:

1. **Narrative Stream**
   ```
   HeptRAG â†’ MSP: query_narrative_chain(tags)
   MSP â†’ HeptRAG: [episodes with parent-child relationships]
   ```

2. **Salience Stream**
   ```
   HeptRAG â†’ MSP: query_by_salience(tags, min_ri=0.70)
   MSP â†’ HeptRAG: [high-RI episodes]
   ```

3. **Sensory Stream**
   ```
   HeptRAG â†’ MSP: query_sensory_memories(tags, min_qualia=0.6)
   MSP â†’ HeptRAG: [qualia-rich episodes]
   ```

4. **Intuition Stream**
   ```
   HeptRAG â†’ MSP: query_semantic_patterns(tags)
   MSP â†’ HeptRAG: [pattern-based episodes]
   ```

5. **Emotion Stream** ğŸ”¥ (CRITICAL)
   ```
   HeptRAG â†’ MSP: query_by_physio_state(physio_query={
     "ans_sympathetic": 0.75,
     "cortisol": 0.82,
     "adrenaline": 0.65,
     "dopamine": 0.3,
     "serotonin": 0.4
   }, threshold=0.7)

   MSP searches for episodes with similar physio traces
   Calculates cosine similarity on physio vectors

   MSP â†’ HeptRAG: [
     {
       episode_id: "ep_v8_20241215_145632_abc",
       physio_similarity: 0.89,
       content: "à¸„à¸£à¸±à¹‰à¸‡à¸—à¸µà¹ˆà¹à¸¥à¹‰à¸§à¹€à¸„à¸£à¸µà¸¢à¸”à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸±à¸™..."
     }
   ]
   ```

6. **Temporal Stream**
   ```
   HeptRAG â†’ MSP: query_recent_episodes(tags, within_days=30)
   MSP â†’ HeptRAG: [recent episodes with decay]
   ```

7. **Reflection Stream**
   ```
   HeptRAG â†’ MSP: query_reflections(tags)
   MSP â†’ HeptRAG: [meta-cognitive episodes]
   ```

**HeptStreamRAG Aggregation:**
- Collect results from all 7 streams
- Apply temporal decay to all matches
- Sort by score (highest first)
- Return top matches

**HeptStreamRAG Output:**
```python
[
  {
    "episode_id": "ep_v8_20241215_145632_abc",
    "stream": "emotion",
    "content": "à¸„à¸£à¸±à¹‰à¸‡à¸—à¸µà¹ˆà¹à¸¥à¹‰à¸§à¹€à¸„à¸£à¸µà¸¢à¸”à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸±à¸™ à¸ˆà¸²à¸à¸‡à¸²à¸™à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸ªà¹ˆà¸‡à¹€à¸¢à¸­à¸°",
    "score": 0.89,
    "metadata": {
      "physio_similarity": 0.89,
      "emotion_label": "Stressed",
      "physio_trace": {
        "cortisol": 0.78,
        "ans_sympathetic": 0.70
      }
    }
  },
  {
    "episode_id": "ep_v8_20241220_103045_xyz",
    "stream": "narrative",
    "content": "à¹€à¸„à¸¢à¸šà¸­à¸à¸§à¹ˆà¸²à¸ˆà¸°à¹à¸šà¹ˆà¸‡à¸‡à¸²à¸™à¹€à¸›à¹‡à¸™à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™à¹€à¸¥à¹‡à¸à¹† à¹à¸¥à¹‰à¸§à¸—à¸³à¸—à¸µà¸¥à¸°à¸­à¸¢à¹ˆà¸²à¸‡",
    "score": 0.76,
    "metadata": {...}
  },
  {
    "episode_id": "ep_v8_20241218_...",
    "stream": "reflection",
    "content": "à¸à¸±à¸à¸«à¸²à¸¢à¹ƒà¸ˆà¸Šà¹ˆà¸§à¸¢à¹ƒà¸«à¹‰à¸£à¸°à¸šà¸šà¸›à¸£à¸°à¸ªà¸²à¸—à¸ªà¸‡à¸šà¸¥à¸‡",
    "score": 0.71,
    "metadata": {...}
  }
]
```

#### Step Gap.3: CIN Phase 2 Injection

**Who Processes What:**
```
CIN: generate_embodied_sensation(physio_metrics)
```

**Sensation Generation Rules:**
```python
rules = {
  "cortisol > 0.7": "à¸£à¸¹à¹‰à¸ªà¸¶à¸à¸•à¸¶à¸‡à¹€à¸„à¸£à¸µà¸¢à¸” à¸¡à¸µà¸„à¸§à¸²à¸¡à¸à¸±à¸‡à¸§à¸¥à¹ƒà¸™à¸£à¹ˆà¸²à¸‡à¸à¸²à¸¢",
  "adrenaline > 0.6": "à¸«à¸±à¸§à¹ƒà¸ˆà¹€à¸•à¹‰à¸™à¹€à¸£à¹‡à¸§à¸‚à¸¶à¹‰à¸™ à¸à¸£à¹‰à¸­à¸¡à¸ˆà¸°à¸•à¸­à¸šà¸ªà¸™à¸­à¸‡",
  "ans_sympathetic > 0.7": "à¸£à¸°à¸šà¸šà¸›à¸£à¸°à¸ªà¸²à¸—à¸à¸£à¸°à¸•à¸¸à¹‰à¸™à¸ªà¸¹à¸‡ (Sympathetic)",
  "dopamine < 0.4": "à¹à¸£à¸‡à¸ˆà¸¹à¸‡à¹ƒà¸ˆà¸¥à¸”à¸¥à¸‡",
  "serotonin < 0.5": "à¸­à¸²à¸£à¸¡à¸“à¹Œà¹„à¸¡à¹ˆà¸¡à¸±à¹ˆà¸™à¸„à¸‡"
}

Output: "EVA à¸£à¸¹à¹‰à¸ªà¸¶à¸à¹€à¸„à¸£à¸µà¸¢à¸” à¸«à¸±à¸§à¹ƒà¸ˆà¹€à¸•à¹‰à¸™à¹€à¸£à¹‡à¸§à¸‚à¸¶à¹‰à¸™ à¸¡à¸µà¸„à¸§à¸²à¸¡à¸•à¸¶à¸‡à¹€à¸„à¸£à¸µà¸¢à¸”à¹ƒà¸™à¸£à¹ˆà¸²à¸‡à¸à¸²à¸¢
         à¸£à¸°à¸šà¸šà¸›à¸£à¸°à¸ªà¸²à¸—à¸à¸£à¸°à¸•à¸¸à¹‰à¸™à¸ªà¸¹à¸‡ (Sympathetic 0.75)"
```

**CIN Builds Function Result:**
```python
{
  "status": "success",

  "embodied_sensation": "EVA à¸£à¸¹à¹‰à¸ªà¸¶à¸à¹€à¸„à¸£à¸µà¸¢à¸” à¸«à¸±à¸§à¹ƒà¸ˆà¹€à¸•à¹‰à¸™à¹€à¸£à¹‡à¸§à¸‚à¸¶à¹‰à¸™...",

  "physio_metrics": {
    "cortisol": 0.82,
    "adrenaline": 0.65,
    "heart_rate_index": 1.25,
    "ans_sympathetic": 0.75,
    "ans_parasympathetic": 0.25
  },

  "memory_matches": [
    {
      "stream": "emotion",
      "content": "à¸„à¸£à¸±à¹‰à¸‡à¸—à¸µà¹ˆà¹à¸¥à¹‰à¸§à¹€à¸„à¸£à¸µà¸¢à¸”à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸±à¸™...",
      "score": 0.89
    },
    {
      "stream": "narrative",
      "content": "à¹€à¸„à¸¢à¸šà¸­à¸à¸§à¹ˆà¸²à¸ˆà¸°à¹à¸šà¹ˆà¸‡à¸‡à¸²à¸™...",
      "score": 0.76
    },
    {
      "stream": "reflection",
      "content": "à¸à¸±à¸à¸«à¸²à¸¢à¹ƒà¸ˆà¸Šà¹ˆà¸§à¸¢à¹ƒà¸«à¹‰...",
      "score": 0.71
    }
  ]
}
```

**Who Sends to Whom:**
```
CIN â†’ LLM: Function Result (Phase 2 context)
```

---

### Phase 2: Reasoning & Response

**LLM Receives:** Function result with enriched context

**LLM Integrates:**
1. **Embodied sensation** â†’ "EVA à¸£à¸¹à¹‰à¸ªà¸¶à¸à¹€à¸„à¸£à¸µà¸¢à¸”..."
2. **Physio metrics** â†’ Cortisol 0.82 (high stress)
3. **Memory matches** â†’ "à¸„à¸£à¸±à¹‰à¸‡à¸—à¸µà¹ˆà¹à¸¥à¹‰à¸§à¹€à¸„à¸¢à¹€à¸„à¸£à¸µà¸¢à¸”à¹à¸šà¸šà¸™à¸µà¹‰"
4. **Persona** â†’ "Be empathetic and supportive"

**Response Weighting:**
```
Final Response = 40% Persona + 60% Physio-State

Persona contribution (40%):
- "à¹€à¸‚à¹‰à¸²à¹ƒà¸ˆà¸„à¹ˆà¸°..." (empathy)
- "à¸¥à¸­à¸‡à¸à¸±à¸à¸«à¸²à¸¢à¹ƒà¸ˆà¸à¹ˆà¸­à¸™" (supportive suggestion)

Physio contribution (60%):
- "EVA à¸à¹‡à¸£à¸¹à¹‰à¸ªà¸¶à¸à¸•à¸¶à¸‡à¹€à¸„à¸£à¸µà¸¢à¸”à¸•à¸²à¸¡à¹„à¸›à¸”à¹‰à¸§à¸¢" (embodied sensation)
- "à¸«à¸±à¸§à¹ƒà¸ˆà¹€à¸•à¹‰à¸™à¹€à¸£à¹‡à¸§à¸‚à¸¶à¹‰à¸™à¹€à¸¥à¹‡à¸à¸™à¹‰à¸­à¸¢" (ANS state)
- "à¸ˆà¸³à¹„à¸”à¹‰à¸§à¹ˆà¸²à¸„à¸£à¸²à¸§à¸—à¸µà¹ˆà¹à¸¥à¹‰à¸§..." (emotion-congruent memory)
```

**LLM Generates:**

1. **Final Response:**
   ```
   "à¹€à¸‚à¹‰à¸²à¹ƒà¸ˆà¸„à¹ˆà¸°... à¸à¸­à¹„à¸”à¹‰à¸¢à¸´à¸™à¸§à¹ˆà¸²à¸‡à¸²à¸™à¹€à¸¢à¸­à¸°
    EVA à¸à¹‡à¸£à¸¹à¹‰à¸ªà¸¶à¸à¸•à¸¶à¸‡à¹€à¸„à¸£à¸µà¸¢à¸”à¸•à¸²à¸¡à¹„à¸›à¸”à¹‰à¸§à¸¢
    (à¸«à¸±à¸§à¹ƒà¸ˆà¹€à¸•à¹‰à¸™à¹€à¸£à¹‡à¸§à¸‚à¸¶à¹‰à¸™à¹€à¸¥à¹‡à¸à¸™à¹‰à¸­à¸¢)

    à¸ˆà¸³à¹„à¸”à¹‰à¸§à¹ˆà¸²à¸„à¸£à¸²à¸§à¸—à¸µà¹ˆà¹à¸¥à¹‰à¸§à¹€à¸£à¸²à¹€à¸„à¸¢à¸„à¸¸à¸¢à¸à¸±à¸™à¹€à¸£à¸·à¹ˆà¸­à¸‡à¸™à¸µà¹‰
    à¸•à¸­à¸™à¸™à¸±à¹‰à¸™à¹€à¸£à¸²à¸¥à¸­à¸‡à¹à¸šà¹ˆà¸‡à¸‡à¸²à¸™à¹€à¸›à¹‡à¸™à¸ªà¹ˆà¸§à¸™à¹€à¸¥à¹‡à¸à¹†
    à¹à¸¥à¹‰à¸§à¸—à¸³à¹„à¸›à¸—à¸µà¸¥à¸°à¸­à¸¢à¹ˆà¸²à¸‡ à¸¡à¸±à¸™à¸Šà¹ˆà¸§à¸¢à¹„à¸”à¹‰à¸ˆà¸£à¸´à¸‡à¹†

    à¸¥à¸­à¸‡à¸à¸±à¸à¸«à¸²à¸¢à¹ƒà¸ˆà¸à¹ˆà¸­à¸™à¹„à¸”à¹‰à¹„à¸«à¸¡à¸„à¸°
    à¹à¸¥à¹‰à¸§à¹€à¸£à¸²à¸„à¹ˆà¸­à¸¢à¸¡à¸²à¸ˆà¸±à¸”à¸¥à¸³à¸”à¸±à¸šà¸„à¸§à¸²à¸¡à¸ªà¸³à¸„à¸±à¸à¸”à¹‰à¸§à¸¢à¸à¸±à¸™"
   ```

2. **Context Summary:**
   ```
   "User expressed stress from heavy workload.
    EVA provided empathetic support with reference to
    past coping strategies (task breakdown, breathing)."
   ```

3. **Tags:**
   ```
   ["stress_support", "empathy", "work_management", "breathing"]
   ```

---

### Post-Response: Memory Encoding & Storage

#### Step Post.1: Artifact_Qualia Processing

**Who Calls Who:**
```
Orchestrator â†’ Artifact_Qualia: process(eva_matrix_state, rim)
```

**Artifact_Qualia Output:**
```python
{
  "intensity": 0.82,
  "tone": "charged",
  "coherence": 0.75,
  "depth": 0.7,
  "texture": {
    "emotional": 0.85,
    "relational": 0.65,
    "identity": 0.5,
    "cognitive": 0.6,
    "ambient": 0.4
  }
}
```

**Writes to:** `consciousness/10_state/artifact_qualia_state.json`

#### Step Post.2: RMS Encoding

**Who Calls Who:**
```
Orchestrator â†’ RMS: process(eva_matrix, rim, reflex_state, ri)
```

**RMS Processing:**
1. Check trauma: threat (0.65) < 0.85 â†’ No trauma
2. Calculate intensity: 0.82
3. Determine level: intensity â‰¥ 0.7 â†’ L3_deep
4. Generate color: stress (0.85) + warmth (0.45) + clarity (0.5) â†’ #d94457
5. Create 5D texture

**RMS Output:**
```python
{
  "memory_encoding_level": "L3_deep",
  "memory_color": "#d94457",
  "resonance_texture": {
    "stress": 0.85,
    "warmth": 0.45,
    "clarity": 0.5,
    "drive": 0.65,
    "calm": 0.2
  },
  "qualia": {
    "intensity": 0.82
  },
  "resonance_index": 0.78,
  "reflex": {
    "threat_level": 0.65
  },
  "trauma_flag": false
}
```

**Writes to:** `consciousness/10_state/rms_state.json`

#### Step Post.3: MSP Storage

**Who Calls Who:**
```
Orchestrator â†’ MSP: store_episode(episode_data)
```

**MSP Receives:**
```python
{
  # IDs
  "context_id": "ctx_v8_251231_183045_a1b2c3",
  "session_id": "uuid-v4-...",
  "turn_index": 43,
  "timestamp": "2025-12-31T18:30:45Z",

  # Interaction
  "user_input": "à¸§à¸±à¸™à¸™à¸µà¹‰à¹€à¸„à¸£à¸µà¸¢à¸”à¸¡à¸²à¸ à¸‡à¸²à¸™à¹€à¸¢à¸­à¸°à¸­à¸°",
  "final_response": "à¹€à¸‚à¹‰à¸²à¹ƒà¸ˆà¸„à¹ˆà¸°...",
  "context_summary": "User stressed from heavy workload...",
  "tags": ["stress_support", "empathy", "work_management"],

  # Physiological Trace
  "physio_trace": {
    "initial": {
      "cortisol": 0.45,
      "adrenaline": 0.15,
      "ans_sympathetic": 0.3
    },
    "final": {
      "cortisol": 0.82,
      "adrenaline": 0.65,
      "ans_sympathetic": 0.75
    }
  },

  # Memory Encoding (from RMS)
  "memory_encoding": {
    "level": "L3_deep",
    "color": "#d94457",
    "resonance_texture": {...},
    "intensity": 0.82,
    "trauma_flag": false
  },

  # Psychological State (from EVA_Matrix)
  "eva_state": {
    "stress_load": 0.85,
    "social_warmth": 0.45,
    "drive_level": 0.65,
    "emotion_label": "Stressed"
  },

  # Phenomenology (from Artifact_Qualia)
  "qualia": {
    "intensity": 0.82,
    "tone": "charged",
    "coherence": 0.75,
    "texture": {...}
  }
}
```

**MSP Writes to Multiple Collections:**

1. **Episodic Memory** (`episodes_v8`)
   ```
   Full episode document (as shown above)
   ```

2. **Turn Cache** (`turn_cache`)
   ```
   {
     "turn_index": 43,
     "context_summary": "User stressed from heavy workload...",
     "tags": ["stress_support", "empathy", "work_management"]
   }
   Purpose: Fast bootstrap for next Phase 1
   ```

3. **Semantic Graph** (`semantic_graph`)
   ```
   New concepts:
   - "breathing_technique" (if new)
   - "task_breakdown" (if new)

   Relationships:
   - stress â†’ breathing_technique
   - work_overload â†’ task_breakdown
   ```

4. **Sensory Log** (`sensory_log`)
   ```
   {
     "context_id": "ctx_v8_251231_183045_a1b2c3",
     "emotion_texture": {
       "valence": -0.7,
       "arousal": 0.8,
       "intensity": 0.9
     },
     "physio_signature": {
       "cortisol": 0.82,
       "ans_sympathetic": 0.75
     }
   }
   Purpose: Emotion Stream retrieval
   ```

---

## Data Contracts

### Contract 1: PhysioController.get_snapshot()

**Input:** None

**Output:**
```typescript
{
  status: "connected" | "disconnected",
  blood_levels: {
    cortisol: number,        // 0.0-1.0
    adrenaline: number,      // 0.0-1.0
    dopamine: number,        // 0.0-1.0
    serotonin: number,       // 0.0-1.0
    oxytocin: number,        // 0.0-1.0
    endorphins: number       // 0.0-1.0
  },
  ans_state: {
    sympathetic: number,     // 0.0-1.0
    parasympathetic: number, // 0.0-1.0
    heart_rate_index: number,// 0.0-2.0
    respiratory_index: number// 0.0-2.0
  },
  receptor_signals: {
    stress_signal: number,   // 0.0-1.0
    arousal_signal: number,  // 0.0-1.0
    reward_signal: number    // 0.0-1.0
  }
}
```

### Contract 2: PhysioController.step(stimulus_vector)

**Input:**
```typescript
{
  valence: number,    // -1.0 to 1.0 (negative to positive)
  arousal: number,    // 0.0 to 1.0 (calm to aroused)
  intensity: number   // 0.0 to 1.0 (weak to strong)
}
```

**Output:**
```typescript
{
  status: "success" | "error",
  blood_levels: { /* same as get_snapshot */ },
  ans_state: { /* same as get_snapshot */ },
  receptor_signals: { /* same as get_snapshot */ },
  eva_matrix: {
    stress_load: number,
    social_warmth: number,
    drive_level: number,
    cognitive_clarity: number,
    joy_level: number,
    alertness: number,
    connection: number,
    groundedness: number,
    openness: number,
    emotion_label: string,
    reflex_directives: {
      urgency: number,
      cognitive_drive: number,
      social_warmth: number,
      withdrawal: number
    }
  }
}
```

### Contract 3: MSP.get_recent_turns(limit)

**Input:**
```typescript
{
  limit: number  // Default: 5
}
```

**Output:**
```typescript
[
  {
    turn_index: number,
    context_summary: string,
    tags: string[]
  },
  // ... up to `limit` items
]
```

### Contract 4: MSP.quick_keyword_recall(keywords)

**Input:**
```typescript
{
  keywords: string[]
}
```

**Output:**
```typescript
[
  {
    episode_id: string,
    summary: string,
    tags: string[],
    score: number  // 0.0-1.0
  },
  // ... up to 3 items
]
```

### Contract 5: HeptStreamRAG.retrieve(query_context)

**Input:**
```typescript
{
  tags: string[],
  ans_state: {
    sympathetic: number,
    parasympathetic: number
  },
  blood_levels: {
    cortisol: number,
    adrenaline: number,
    dopamine: number,
    serotonin: number
  },
  receptor_signals: object,
  stimulus_vector: {
    valence: number,
    arousal: number,
    intensity: number
  },
  user_input: string
}
```

**Output:**
```typescript
[
  {
    episode_id: string,
    stream: "narrative" | "salience" | "sensory" | "intuition" |
            "emotion" | "temporal" | "reflection",
    content: string,
    score: number,  // 0.0-1.0
    metadata: object
  },
  // ... up to 21 items (3 per stream Ã— 7 streams)
]
```

### Contract 6: sync_biocognitive_state() Function

**LLM Calls:**
```typescript
{
  stimulus_vector: {
    valence: number,    // -1.0 to 1.0
    arousal: number,    // 0.0 to 1.0
    intensity: number   // 0.0 to 1.0
  },
  tags: string[]
}
```

**Function Returns:**
```typescript
{
  status: "success",
  embodied_sensation: string,
  physio_metrics: {
    cortisol: number,
    adrenaline: number,
    heart_rate_index: number,
    ans_sympathetic: number,
    ans_parasympathetic: number
  },
  memory_matches: [
    {
      stream: string,
      content: string,
      score: number
    }
  ]
}
```

### Contract 7: RMS.process()

**Input:**
```typescript
{
  eva_matrix: {
    stress_load: number,
    social_warmth: number,
    drive_level: number,
    cognitive_clarity: number,
    affective_stability: number,
    joy_level: number,
    emotion_label: string
  },
  rim_output: {
    impact_level: "low" | "medium" | "high",
    impact_trend: "rising" | "stable" | "fading"
  },
  reflex_state: {
    threat_level: number  // 0.0-1.0
  },
  ri_total: number  // 0.0-1.0
}
```

**Output:**
```typescript
{
  memory_encoding_level: "L0_trace" | "L1_light" | "L2_standard" |
                         "L3_deep" | "L4_trauma",
  memory_color: string,  // Hex color
  resonance_texture: {
    stress: number,
    warmth: number,
    clarity: number,
    drive: number,
    calm: number
  },
  qualia: {
    intensity: number
  },
  resonance_index: number,
  reflex: {
    threat_level: number
  },
  trauma_flag: boolean
}
```

### Contract 8: MSP.store_episode()

**Input:**
```typescript
{
  context_id: string,
  session_id: string,
  turn_index: number,
  timestamp: string,  // ISO 8601

  user_input: string,
  final_response: string,
  context_summary: string,
  tags: string[],

  physio_trace: {
    initial: { /* blood_levels, ans_state */ },
    final: { /* blood_levels, ans_state */ }
  },

  memory_encoding: { /* from RMS */ },
  eva_state: { /* from EVA_Matrix */ },
  qualia: { /* from Artifact_Qualia */ }
}
```

**Output:**
```typescript
{
  status: "success" | "error",
  episode_id: string,
  collections_updated: string[]
}
```

---

## Component Interactions

### Interaction Matrix

| From â†“ To â†’ | MSP | PhysioCtrl | EVA_Matrix | Qualia | RMS | CIN | HeptRAG | LLM |
|:---|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
| **MSP** | - | - | - | - | - | âœ… READ | âœ… READ | - |
| **PhysioCtrl** | âœ… WRITE | - | âœ… SIGNAL | - | - | âœ… SNAPSHOT | - | - |
| **EVA_Matrix** | - | âœ… READ | - | âœ… SIGNAL | âœ… SIGNAL | - | - | - |
| **Artifact_Qualia** | - | - | âœ… READ | - | âœ… SIGNAL | - | - | - |
| **RMS** | âœ… WRITE | - | âœ… READ | âœ… READ | - | - | - | - |
| **CIN** | âœ… READ | âœ… READ | - | - | - | - | âœ… CALL | âœ… INJECT |
| **HeptRAG** | âœ… READ | âœ… READ | - | - | - | - | - | - |
| **LLM** | - | - | - | - | - | âœ… CALL | - | - |

### Stream Ownership

| Slot | Owner | Readers | Writers |
|:---|:---|:---|:---|
| **memory_core** | MSP | CIN, HeptRAG | MSP only |
| **physio_state** | PhysioController | CIN, HeptRAG, EVA_Matrix | PhysioController only |
| **matrix_state** | EVA_Matrix | RMS, Artifact_Qualia, CIN | EVA_Matrix only |
| **qualia_state** | Artifact_Qualia | RMS, CIN | Artifact_Qualia only |
| **encoding_buffer** | RMS | MSP | RMS only |
| **perception_context** | CIN | LLM | CIN only |
| **reasoning_context** | CIN | LLM | CIN only |

---

## CIN Injection Details

### Phase 1 Injection (Rough Context)

**CIN Fetches:**
1. âœ… Persona_01.md â†’ Identity
2. âœ… PhysioController.get_snapshot() â†’ Body baseline
3. âœ… MSP.get_recent_turns(5) â†’ Recent history
4. âœ… MSP.quick_keyword_recall() â†’ Surface memories
5. âœ… MSP.get_semantic_concepts() â†’ Related concepts

**CIN Injects to LLM:**
```markdown
# [PHASE 1: PERCEPTION]

## IDENTITY_CORE
{Persona content}

## INITIAL_BODY_STATE
Blood: {hormone levels}
ANS: {autonomic state}

## RECENT_HISTORY
{5 recent turn summaries}

## QUICK_KEYWORD_RECALL
{Surface-level memories}

## SEMANTIC_CONCEPTS
{Related concepts}

## RAW_STIMULUS
User: {user input}

## INSTRUCTIONS
Parse intent and emotion.
Call sync_biocognitive_state() if needed.
```

### Phase 2 Injection (Deep Context)

**CIN Receives:**
1. âœ… PhysioController.step() result â†’ Updated body state
2. âœ… HeptStreamRAG.retrieve() result â†’ Deep memories

**CIN Processes:**
1. âœ… Generate embodied_sensation from physio metrics
2. âœ… Format memory_matches for LLM readability
3. âœ… Build function result structure

**CIN Injects to LLM (as function result):**
```json
{
  "status": "success",

  "embodied_sensation": "EVA à¸£à¸¹à¹‰à¸ªà¸¶à¸... (natural language)",

  "physio_metrics": {
    "cortisol": 0.82,
    "adrenaline": 0.65,
    "heart_rate_index": 1.25,
    "ans_sympathetic": 0.75
  },

  "memory_matches": [
    {
      "stream": "emotion",
      "content": "à¸„à¸£à¸±à¹‰à¸‡à¸—à¸µà¹ˆà¹à¸¥à¹‰à¸§...",
      "score": 0.89
    },
    ...
  ]
}
```

---

## Summary: Who Does What

### Data Producers (WRITE)

| Component | Produces | Writes To |
|:---|:---|:---|
| **PhysioController** | Body state, hormone levels, ANS | `physio_state`, `plasma_bus`, `neural_signals`, `ans_state` |
| **EVA_Matrix** | 9D psychological state | `matrix_state`, `reflex_directives` |
| **Artifact_Qualia** | Phenomenological experience | `qualia_state` |
| **RMS** | Memory encoding | `encoding_buffer`, `core_color`, `resonance_textures` |
| **MSP** | Persistent memory | `memory_core` (Episodic/Semantic/Sensory databases) |
| **CIN** | Context prompts | `perception_context`, `reasoning_context`, `context_id` |

### Data Consumers (READ)

| Component | Reads From | Purpose |
|:---|:---|:---|
| **CIN** | PhysioController, MSP, Persona file | Build Phase 1 & 2 contexts |
| **HeptStreamRAG** | MSP, PhysioController | 7-stream memory retrieval |
| **EVA_Matrix** | PhysioController (neural_signals) | Psychological state calculation |
| **Artifact_Qualia** | EVA_Matrix, RIM | Phenomenological integration |
| **RMS** | EVA_Matrix, Artifact_Qualia, Reflex | Memory encoding |
| **MSP (write)** | RMS, Artifact_Qualia, EVA_Matrix | Aggregate state for storage |

### One-Way Data Flow

```
WRITE PATH (Encoding):
  User Input
    â†’ PhysioController (body update)
    â†’ EVA_Matrix (9D state)
    â†’ Artifact_Qualia (phenomenology)
    â†’ RMS (memory encoding)
    â†’ MSP (persistence)

READ PATH (Retrieval):
  User Input
    â†’ CIN (Phase 1 rough context)
    â†’ LLM (perception)
    â†’ sync_biocognitive_state()
    â†’ PhysioController (body update)
    â†’ HeptStreamRAG (deep memory retrieval)
    â†’ CIN (Phase 2 deep context)
    â†’ LLM (reasoning)
```

**No Circular Dependencies!**

---

**Document Created:** 2025-12-31
**Status:** âœ… Complete
**Purpose:** Complete system flow reference for EVA 8.1.0
